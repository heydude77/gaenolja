<?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="comments">
<!-- 댓글 저장하는거 -->
	<insert id="addByComments" parameterType="java.util.HashMap">
		insert into comments values(opinion_seq.nextval, #{comments}, #{talker}, #{ino}, sysdate, #{serial})
	</insert>

<!-- 특정 게시글 댓글 전부 뽑는거(오름차순) -->
	<select id="getAllByComments" resultType="java.util.HashMap" parameterType="java.lang.Integer">
		select * from comments where ino=#{ino} order by regdate asc
	</select>

<!-- 게시글 댓글별 리댓글 카운트 뽑는거 -->
	<select id="getByCmtCount" resultType="java.util.HashMap" parameterType="java.lang.Integer">
		select cnt, serial, code from (COMMENTS join (select code, count(*) as cnt from RECOMMENTS GROUP by CODE)r on COMMENTS.serial = r.code) where ino = #{no}
	</select>
	
</mapper>

